<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>BrobyVets</title><link rel="stylesheet" href="sidebar.css">
<style>
/* Template dropdown scrollbar styling */
#template-list {
  scrollbar-width: thin;
  scrollbar-color: #CBD5E0 #F7FAFC;
}
#template-list::-webkit-scrollbar {
  width: 8px;
}
#template-list::-webkit-scrollbar-track {
  background: #F7FAFC;
  border-radius: 4px;
}
#template-list::-webkit-scrollbar-thumb {
  background: #CBD5E0;
  border-radius: 4px;
}
#template-list::-webkit-scrollbar-thumb:hover {
  background: #A0AEC0;
}
</style>
</head>
<body>
<div id="brobyvets-sidebar">

<!-- Header -->
<div class="sidebar-header">
<div class="logo" id="sidebarLogo">
<img src="icons/icon48.png" alt="Broby" />
</div>
<div class="header-actions">
<button class="header-btn">Web</button>
<button class="header-btn" id="logoutBtn" style="display:none">Logout</button>
</div>
</div>

<!-- Paused Consultations Grid -->
<div class="paused-consults" id="paused-consultations" style="display:none">
<div class="paused-consults-title">PAUSED CONSULTATIONS</div>
<div class="paused-grid" id="pausedGrid">
<!-- Dynamically populated -->
</div>
</div>

<!-- Login Modal -->
<div id="login-modal" class="login-modal">
<div class="login-modal-header">
<h2>Sign In</h2>
<p class="login-subtitle">Enter your credentials to continue</p>
</div>
<div class="input-group">
<label>Email</label>
<input type="email" id="email" placeholder="your@email.com" autocomplete="email" required />
</div>
<div class="input-group">
<label>Password</label>
<input type="password" id="password" placeholder="••••••••" autocomplete="current-password" required />
</div>
<div id="error-message" class="error-message" style="display:none"></div>
<button class="btn-start" id="login-btn">
<span class="btn-text">Sign In</span>
<span class="btn-spinner" style="display:none">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
<path d="M12 2 A10 10 0 0 1 22 12" stroke-linecap="round">
<animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/>
</path>
</svg>
</span>
</button>
</div>

<!-- Main Content -->
<div id="main-content" style="display:none">

<!-- Ready State (Patient Info + Start Button) -->
<div id="ready-state" class="state-view">
<div class="patient-info">
<div class="patient-name" id="ready-patient-name">Select a patient in EzyVet</div>
<div class="patient-details" id="ready-patient-details"></div>
</div>
<button class="btn-start" id="startBtn">▶ Start Consult</button>
</div>

<!-- Recording State -->
<div id="recording-state" class="state-view" style="display:none">
<div class="patient-info">
<div class="patient-name" id="recording-patient-name">Bunny</div>
<div class="patient-details" id="recording-patient-details">Dog • ID: 12345 • 23/10/2025</div>
</div>
<div class="recording-badge">
<span class="recording-dot"></span>
<span id="recording-status">Recording</span>
</div>
<div class="timer" id="timer">00:00:01</div>
<div class="waveform" id="waveform">
<div class="waveform-bar"></div>
<div class="waveform-bar"></div>
<div class="waveform-bar"></div>
<div class="waveform-bar"></div>
<div class="waveform-bar"></div>
<div class="waveform-bar"></div>
<div class="waveform-bar"></div>
<div class="waveform-bar"></div>
</div>
<button class="btn-secondary" id="pauseBtn">⏸ Pause</button>
<div class="section">
<div class="section-header">
<span>📷</span>
<span>Photos</span>
<span class="badge" id="photo-count">0</span>
</div>
<div class="photos-grid">
<div class="photo-box" id="addPhotoBtn">+</div>
</div>
</div>
<div class="section" id="template-section">
<div class="section-header" id="template-header" style="cursor:pointer">
<span>📋</span>
<span>Template</span>
<span style="margin-left:auto" id="template-chevron">▼</span>
</div>
<div class="section-content" id="template-display" style="cursor:pointer">
<span id="template-name">Default (No Template)</span>
</div>
</div>
<button class="btn-primary" id="submitBtn">✓ Submit</button>
</div>

<!-- Processing State -->
<div id="processing-state" class="state-view" style="display:none">
<div class="patient-info">
<div class="patient-name" id="processing-patient-name">Bunny</div>
<div class="patient-details" id="processing-patient-details">Dog • ID: 12345 • 23/10/2025</div>
</div>
<div class="processing-content">
<div class="processing-spinner">
<svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#1FC7CA" stroke-width="2">
<circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
<path d="M12 2 A10 10 0 0 1 22 12" stroke-linecap="round">
<animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/>
</path>
</svg>
</div>
<div class="processing-text">Generating AI Summary...</div>
<div class="processing-subtext">This may take a few moments</div>
<!-- Streaming summary display -->
<div class="summary-section" id="streaming-summary" style="display:none; margin-top:20px">
<div class="summary-header">
<span>📝</span>
<span>AI Summary</span>
<span style="margin-left:auto; font-size:11px; color:#9CA3AF">Streaming...</span>
</div>
<div class="summary-content" id="streamingSummaryContent" style="max-height:300px; overflow-y:auto">
<!-- Streaming summary chunks will be inserted here -->
</div>
</div>
</div>
</div>

<!-- Completed State -->
<div id="completed-state" class="state-view" style="display:none">
<div class="patient-info">
<div class="patient-name" id="completed-patient-name">Bunny</div>
<div class="patient-details" id="completed-patient-details">Dog • ID: 12345 • 23/10/2025</div>
</div>
<div class="completed-badge">
<span>✓</span>
<span>Consultation Complete</span>
</div>
<div class="summary-section">
<div class="summary-header">
<span>📝</span>
<span>AI Summary</span>
</div>
<div class="summary-content" id="summaryContent">
<!-- Backend-generated summary will be inserted here -->
</div>
</div>
<div class="completed-actions">
<button class="btn-secondary" id="newConsultBtn">New Consult</button>
<button class="btn-primary" id="insertBtn">Insert into EzyVet</button>
</div>
</div>

</div>

<!-- Template Dropdown (FIXED positioning outside all scrollable containers) -->
<div id="template-dropdown" style="display:none; position:fixed; background:white; border:1px solid #E5E7EB; border-radius:8px; max-height:400px; overflow:hidden; z-index:10000; box-shadow:0 4px 12px rgba(0,0,0,0.15)">
<div style="padding:8px; border-bottom:1px solid #E5E7EB">
<input type="text" id="template-search" placeholder="Search templates..." style="width:100%; padding:6px; border:1px solid #E5E7EB; border-radius:4px; font-size:12px">
</div>
<div id="template-list" style="max-height:350px; overflow-y:auto; overflow-x:hidden">
<!-- Templates will be dynamically populated -->
<div style="padding:12px; text-align:center; color:#9CA3AF; font-size:12px">Loading templates...</div>
</div>
</div>

</div>

<!-- Core Configuration and Auth -->
<script src="config.js"></script>
<script src="auth/token-manager.js"></script>
<script src="auth/auth.js"></script>

<!-- API Services -->
<script src="api/api-client.js"></script>
<script src="api/consultation.service.js"></script>
<script src="api/recording.service.js"></script>
<script src="api/photo.service.js"></script>
<script src="api/template.service.js"></script>

<!-- Utilities -->
<script src="utils/duplicate-detector.js"></script>

<!-- Services -->
<script src="services/summary-service.js"></script>

<!-- Recording -->
<script src="recording/media-recorder.service.js"></script>
<script src="recording/recording-manager.js"></script>

<!-- Main Sidebar Logic -->
<script src="sidebar.js"></script>
</body>
</html>
